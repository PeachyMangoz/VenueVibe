<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Review System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../vv.css">
    <style>
        .review-media {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
        }
        .green-btn {
            background-color: #36b598;
            color: white;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .button-info{
            color: grey;
            font-size: 0.75em;
            text-align: right; 
        }
        body {
            opacity: 0;
            transition: opacity 1s ease-in;
        }
        body.loaded {
            opacity: 1;
        }
        .fade-in {
            animation: fadeIn 1.5s;
        }
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
    </style>
</head>

<body class="fade-in">
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
        <div class="container-fluid">
          <a class="navbar-brand" href="../homepage.html">Boothy</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="apply.html">Apply</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="event_review1.html">Event Reviews</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="booth_listing1.html">Booth Listings</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="forum.html">Forum</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="collaborate.html">Collaborate</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="login.html">Login</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

    <div id="app" class="container py-4">
        <h1 class="mb-4">Event Review System</h1>
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Search Reviews</h2>
                        <form @submit.prevent="searchReviews">
                            <div class="input-group mb-3">
                                <input type="text" v-model="searchEventId" class="form-control" placeholder="Enter Event ID" required>
                                <button class="btn green-btn" type="submit">Search</button> 
                            </div>
                            <p class ="button-info">Click search button or enter to view data charts</p>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Submit Your Review</h2>
                        <button class="btn green-btn" @click="openReviewModal">
                            Open Review Form
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="searchEventId && filteredReviews.length > 0" class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title ">Rating Distribution for Event {{ searchEventId }}</h2>
                        <div class="chart-container">
                            <canvas id="ratingChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <!-- im going to change this to category/type of seller instead of age demogrpahic eg 
             pet supplies/ artist / food -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Demographics for Event {{ searchEventId }}</h2>
                        <div class="chart-container">
                            <canvas id="demographicsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<!-- let me change the style for this -->
        <div class="card mb-4">
            <div class="card-body" style="background-color:#36b598;">
                <h2 class="card-title green-btn">Event Reviews</h2>
                <div id="reviews-container">
                    <div v-if="filteredReviews.length === 0" class="green-btn">No reviews found for this event.</div>
                    <div v-for="(review, index) in filteredReviews" :key="index" class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Event {{ review.eventId }}</h5>
                            <h6 class="card-subtitle mb-2">Rating: {{ review.rating }}/5</h6>
                            <h6 class="card-subtitle mb-2 text-muted">By: {{ review.username }} 
                                <!-- (Age: {{ review.age }}) -->
                            </h6>
                            <p class="card-text">{{ review.description }}</p>
                            <img v-if="review.imageFile" :src="review.imageFile" class="review-media mb-2" alt="Review Image">
                            <video v-if="review.videoFile" :src="review.videoFile" class="review-media mb-2" controls></video>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Review Modal -->
        <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="reviewModalLabel">Submit Your Review</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="submitReview">
                            <div class="mb-3">
                                <label for="eventId" class="form-label">Event ID:</label>
                                <input type="text" id="eventId" v-model="newReview.eventId" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="username" class="form-label">Username:</label>
                                <input type="text" id="username" v-model="newReview.username" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="age" class="form-label">Age:</label>
                                <input type="number" id="age" v-model="newReview.age" class="form-control" required min="18" max="100">
                            </div>
                            <div class="mb-3">
                                <label for="rating" class="form-label">Rating:</label>
                                <select id="rating" v-model="newReview.rating" class="form-select" required>
                                    <option value="">Select a rating</option>
                                    <option v-for="n in 5" :key="n" :value="n">{{ n }} - {{ ratingLabels[n] }}</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="description" class="form-label">Description & Opinion:</label>
                                <textarea id="description" v-model="newReview.description" class="form-control" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="imageFile" class="form-label">Upload Image (optional):</label>
                                <input type="file" id="imageFile" @change="handleImageUpload" class="form-control" accept="image/*">
                            </div>
                            <div class="mb-3">
                                <label for="videoFile" class="form-label">Upload Video (optional):</label>
                                <input type="file" id="videoFile" @change="handleVideoUpload" class="form-control" accept="video/*">
                            </div>
                            <button type="submit" class="btn btn-primary">Submit Review</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- ill need to connect this to database when i figure out how to -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                newReview: {
                    eventId: '',
                    username: '',
                    age: '',
                    rating: '',
                    description: '',
                    imageFile: null,
                    videoFile: null
                },
                reviews: [],
                searchEventId: '',
                ratingLabels: {
                    1: 'Poor',
                    2: 'Fair',
                    3: 'Good',
                    4: 'Very Good',
                    5: 'Excellent'
                },
                ratingChart: null,
                demographicsChart: null,
                reviewModal: null
            },
            computed: {
                filteredReviews() {
                    return this.searchEventId
                        ? this.reviews.filter(review => review.eventId === this.searchEventId)
                        : this.reviews;
                },
                eventRatings() {
                    return [1, 2, 3, 4, 5].map(rating => 
                        this.filteredReviews.filter(review => review.rating === rating).length
                    );
                },
                eventDemographics() {
                    const ageGroups = { '18-24': 0, '25-34': 0, '35-44': 0, '45+': 0 };
                    this.filteredReviews.forEach(review => {
                        const age = parseInt(review.age);
                        if (age < 25) ageGroups['18-24']++;
                        else if (age < 35) ageGroups['25-34']++;
                        else if (age < 45) ageGroups['35-44']++;
                        else ageGroups['45+']++;
                    });
                    return ageGroups;
                }
            },
            methods: {
                openReviewModal() {
                    this.reviewModal.show();
                },
                submitReview() {
                    this.reviews.push({...this.newReview});
                    this.newReview = {
                        eventId: '',
                        username: '',
                        age: '',
                        rating: '',
                        description: '',
                        imageFile: null,
                        videoFile: null
                    };
                    this.updateCharts();
                    this.reviewModal.hide();
                },
                searchReviews() {
                    this.updateCharts();
                },
                handleImageUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.newReview.imageFile = URL.createObjectURL(file);
                    }
                },
                handleVideoUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.newReview.videoFile = URL.createObjectURL(file);
                    }
                },
                updateCharts() {
                    this.updateRatingChart();
                    this.updateDemographicsChart();
                },
                updateRatingChart() {
                    const ctx = document.getElementById('ratingChart');
                    if (this.ratingChart) {
                        this.ratingChart.destroy();
                    }
                    this.ratingChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['1 - Poor', '2 - Fair', '3 - Good', '4 - Very Good', '5 - Excellent'],
                            datasets: [{
                                label: 'Number of Reviews',
                                data: this.eventRatings,
                                backgroundColor: 'rgba(75, 192, 192, 0.6)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    stepSize: 1
                                }
                            }
                        }
                    });
                },
                updateDemographicsChart() {
                    const ctx = document.getElementById('demographicsChart');
                    if (this.demographicsChart) {
                        this.demographicsChart.destroy();
                    }
                    const demographicsData = this.eventDemographics;
                    this.demographicsChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(demographicsData),
                            datasets: [{
                                data: Object.values(demographicsData),
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.8)',
                                    'rgba(54, 162, 235, 0.8)',
                                    'rgba(255, 206, 86, 0.8)',
                                    'rgba(75, 192, 192, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.raw;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${percentage}% (${value})`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            },
            mounted() {
                // Add some sample reviews for testing
                this.reviews = [
                    { eventId: '001', username: 'User1', rating: 4, description: 'Great event!', imageFile: null, videoFile: null, age: '28' },
                    { eventId: '002', username: 'User2', rating: 5, description: 'Awesome experience!', imageFile: null, videoFile: null, age: '35' },
                    { eventId: '001', username: 'User3', rating: 3, description: 'Good, but could be better.', imageFile: null, videoFile: null, age: '42' },
                    { eventId: '001', username: 'User4', rating: 5, description: 'Loved it!', imageFile: null, videoFile: null, age: '22' },
                    { eventId: '002', username: 'User5', rating: 4, description: 'Very enjoyable.', imageFile: null, videoFile: null, age: '31' },
                ];
                this.reviewModal = new bootstrap.Modal(document.getElementById('reviewModal'));
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                document.body.classList.add('loaded');
            }, 100);
        });
    </script>
</body>
</html>